version: 2.1

orbs:
  base: ahmadnassri/base@volatile
  node: ahmadnassri/node@volatile

workflows:
  version: 2
  main:
    jobs:
      - base/clone

      - node/install:
          requires: [ base/clone ]

      - node/lint:
          requires: [ base/clone ]

      - node/test:
          name: node-8
          requires: [ node/install ]
          tag: '8'

      - node/test:
          name: node-10
          requires: [ node/install ]
          tag: '10'

      - node/test:
          name: node-12
          requires: [ node/install ]
          tag: '12'

      - node/release:
          context: semantic-release
          requires: [ node-8, node-10, node-12 ]
          filters:
            branches:
              only: master
